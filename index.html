<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>ì•ŒíŒŒë²³ í•™ìŠµ</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#fef9f0">

<!-- iOS ì›¹ì•± ì„¤ì • -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ì•ŒíŒŒë²³ í•™ìŠµ">
<link rel="apple-touch-icon" href="icon-192.png">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Arial Rounded MT Bold', 'Nunito', sans-serif;
    background: #fef9f0;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ë„¤ë¹„ê²Œì´ì…˜ */
  nav {
    display: flex;
    justify-content: center;
    gap: 12px;
    padding: 20px;
    background: #fff;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  nav button {
    padding: 12px 36px;
    border: none;
    border-radius: 30px;
    font-size: 1.2rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    color: #fff;
  }

  nav button:nth-child(1) {
    background: #a8d8ea;
    color: #2c3e50;
  }

  nav button:nth-child(2) {
    background: #ffb6b9;
    color: #2c3e50;
  }

  nav button:nth-child(3) {
    background: #aa96da;
    color: #2c3e50;
  }

  nav button:nth-child(4) {
    background: #a8e6cf;
    color: #2c3e50;
  }

  nav button.active {
    transform: scale(1.1);
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
  }

  nav button:hover {
    transform: scale(1.05);
  }

  /* í•™ìŠµ ëª¨ë“œ */
  .learn-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 16px;
    padding: 24px;
    max-width: 900px;
    margin: 0 auto;
  }

  .letter-card {
    aspect-ratio: 1;
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    user-select: none;
    position: relative;
  }

  .letter-card:hover {
    transform: scale(1.08);
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  }

  .letter-card .upper {
    font-size: 2.5rem;
    font-weight: bold;
    line-height: 1.1;
  }

  .letter-card .lower {
    font-size: 1.8rem;
    opacity: 0.7;
    line-height: 1.1;
  }

  /* í™•ëŒ€ ì˜¤ë²„ë ˆì´ */
  .overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 200;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .overlay.show {
    display: flex;
    animation: fadeIn 0.2s;
  }

  .overlay-card {
    border-radius: 32px;
    padding: 40px 60px;
    text-align: center;
    animation: bounceIn 0.4s;
  }

  .overlay-card .upper {
    font-size: 8rem;
    font-weight: bold;
    line-height: 1.1;
  }

  .overlay-card .lower {
    font-size: 5rem;
    opacity: 0.7;
  }

  /* í€´ì¦ˆ ëª¨ë“œ */
  #quiz, #listenQuiz, #wordQuiz {
    display: none;
    max-width: 600px;
    margin: 0 auto;
    padding: 24px;
    text-align: center;
  }

  .speaker-btn {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(135deg, #aa96da, #c7b8ea);
    cursor: pointer;
    font-size: 4rem;
    margin: 20px 0 36px;
    box-shadow: 0 6px 20px rgba(170,150,218,0.4);
    transition: transform 0.2s, box-shadow 0.2s;
    animation: bounceIn 0.4s;
  }

  .speaker-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 28px rgba(170,150,218,0.5);
  }

  .speaker-btn:active {
    transform: scale(0.95);
  }

  .speaker-btn.playing {
    animation: pulse 0.6s infinite alternate;
  }

  @keyframes pulse {
    from { transform: scale(1); box-shadow: 0 6px 20px rgba(170,150,218,0.4); }
    to { transform: scale(1.08); box-shadow: 0 10px 32px rgba(170,150,218,0.6); }
  }

  .listen-hint {
    font-size: 1.2rem;
    color: #999;
    margin-bottom: 12px;
  }

  .progress-bar {
    background: #eee;
    border-radius: 20px;
    height: 16px;
    margin-bottom: 12px;
    overflow: hidden;
  }

  .progress-bar .fill {
    height: 100%;
    background: linear-gradient(90deg, #a8d8ea, #aa96da);
    border-radius: 20px;
    transition: width 0.4s;
  }

  .progress-text {
    font-size: 1.1rem;
    color: #666;
    margin-bottom: 24px;
  }

  .quiz-prompt {
    font-size: 7rem;
    font-weight: bold;
    margin: 20px 0 36px;
    animation: bounceIn 0.4s;
  }

  .quiz-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    max-width: 400px;
    margin: 0 auto;
  }

  .quiz-option {
    padding: 20px;
    font-size: 2.5rem;
    font-weight: bold;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    background: #fff;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .quiz-option:hover {
    transform: scale(1.06);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  }

  .quiz-option.correct {
    background: #a8e6cf;
    animation: bounce 0.5s;
  }

  .quiz-option.wrong {
    background: #ffb6b9;
    animation: shake 0.5s;
  }

  .quiz-option.reveal {
    background: #a8e6cf;
    outline: 4px dashed #2ecc71;
  }

  /* ê²°ê³¼ í™”ë©´ */
  .result {
    padding: 40px 24px;
    text-align: center;
  }

  .result h2 {
    font-size: 2rem;
    color: #2c3e50;
    margin-bottom: 16px;
  }

  .result .score {
    font-size: 5rem;
    font-weight: bold;
    color: #aa96da;
    margin: 20px 0;
  }

  .result .message {
    font-size: 1.4rem;
    color: #555;
    margin-bottom: 28px;
  }

  .result button {
    padding: 14px 40px;
    font-size: 1.2rem;
    font-weight: bold;
    border: none;
    border-radius: 30px;
    background: #ffb6b9;
    color: #2c3e50;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .result button:hover { transform: scale(1.08); }

  /* confetti */
  .confetti-piece {
    position: fixed;
    width: 10px;
    height: 10px;
    border-radius: 2px;
    z-index: 300;
    pointer-events: none;
    animation: confettiFall 1.2s forwards;
  }

  /* ì• ë‹ˆë©”ì´ì…˜ */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.08); }
    70% { transform: scale(0.95); }
    100% { transform: scale(1); opacity: 1; }
  }

  @keyframes bounce {
    0%, 100% { transform: scale(1); }
    40% { transform: scale(1.2); }
    60% { transform: scale(0.95); }
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-12px); }
    40% { transform: translateX(12px); }
    60% { transform: translateX(-8px); }
    80% { transform: translateX(8px); }
  }

  @keyframes confettiFall {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(90vh) rotate(720deg); opacity: 0; }
  }

  /* ë„¤ë¹„ ë±ƒì§€ */
  nav button {
    position: relative;
  }

  .nav-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: #ff6b6b;
    color: #fff;
    font-size: 0.65rem;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 10px;
    line-height: 1.2;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  .nav-badge.cleared {
    background: #2ecc71;
  }

  /* ê¸°ë¡ ì„¹ì…˜ */
  .records-section {
    max-width: 600px;
    margin: 0 auto;
    padding: 8px 24px 24px;
  }

  .records-section h3 {
    font-size: 1.3rem;
    color: #2c3e50;
    margin-bottom: 12px;
    text-align: center;
  }

  .records-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
    margin-bottom: 20px;
  }

  .record-card {
    background: #fff;
    border-radius: 16px;
    padding: 16px 12px;
    text-align: center;
    box-shadow: 0 3px 10px rgba(0,0,0,0.06);
  }

  .record-card .record-label {
    font-size: 0.85rem;
    color: #999;
    margin-bottom: 4px;
  }

  .record-card .record-best {
    font-size: 1.8rem;
    font-weight: bold;
    color: #aa96da;
  }

  .record-card .record-best small {
    font-size: 0.9rem;
    color: #bbb;
    font-weight: normal;
  }

  .history-list {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.06);
    overflow: hidden;
  }

  .history-list h4 {
    padding: 12px 16px 8px;
    color: #2c3e50;
    font-size: 1rem;
    border-bottom: 1px solid #f0f0f0;
  }

  .history-row {
    display: flex;
    align-items: center;
    padding: 10px 16px;
    border-bottom: 1px solid #f5f5f5;
    font-size: 0.9rem;
  }

  .history-row:last-child {
    border-bottom: none;
  }

  .history-date {
    flex: 1;
    color: #666;
  }

  .history-scores {
    display: flex;
    gap: 12px;
  }

  .history-scores span {
    padding: 3px 10px;
    border-radius: 10px;
    font-size: 0.8rem;
    font-weight: bold;
  }

  .history-scores .quiz-tag { background: #ffb6b9; color: #2c3e50; }
  .history-scores .listen-tag { background: #c7b8ea; color: #2c3e50; }
  .history-scores .word-tag { background: #a8e6cf; color: #2c3e50; }
  .history-scores .no-record { background: #eee; color: #bbb; }

  .history-empty {
    padding: 24px;
    text-align: center;
    color: #bbb;
    font-size: 0.95rem;
  }

  /* ë‹¨ì–´ í€´ì¦ˆ ë‹¨ê³„ ì„ íƒ */
  .level-select {
    max-width: 600px;
    margin: 0 auto;
    padding: 24px;
  }

  .level-select h2 {
    text-align: center;
    font-size: 1.6rem;
    color: #2c3e50;
    margin-bottom: 20px;
  }

  .level-cards {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .level-card {
    display: flex;
    align-items: center;
    gap: 16px;
    background: #fff;
    border: none;
    border-radius: 20px;
    padding: 18px 20px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transition: transform 0.2s, box-shadow 0.2s;
    text-align: left;
    width: 100%;
    font-family: inherit;
  }

  .level-card:hover {
    transform: scale(1.03);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  }

  .level-num {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    font-weight: bold;
    color: #fff;
    flex-shrink: 0;
  }

  .level-info {
    flex: 1;
    min-width: 0;
  }

  .level-name {
    font-size: 1.1rem;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 2px;
  }

  .level-preview {
    font-size: 0.85rem;
    color: #999;
  }

  .level-best {
    font-size: 0.8rem;
    font-weight: bold;
    color: #aa96da;
    background: #f3eefa;
    padding: 4px 10px;
    border-radius: 12px;
    flex-shrink: 0;
  }

  /* ë‹¨ì–´ í•™ìŠµ */
  .word-study {
    max-width: 600px;
    margin: 0 auto;
    padding: 24px;
    text-align: center;
  }

  .word-study h2 {
    font-size: 1.6rem;
    color: #2c3e50;
    margin-bottom: 20px;
  }

  .word-study-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 24px;
  }

  .word-study-card {
    background: #fff;
    border-radius: 16px;
    padding: 14px 8px;
    text-align: center;
    box-shadow: 0 3px 10px rgba(0,0,0,0.06);
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    user-select: none;
  }

  .word-study-card:hover {
    transform: scale(1.06);
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  }

  .word-study-card:active {
    transform: scale(0.95);
  }

  .word-study-card .emoji {
    font-size: 2rem;
    line-height: 1.2;
  }

  .word-study-card .word {
    font-size: 0.9rem;
    font-weight: bold;
    color: #2c3e50;
    margin-top: 4px;
  }

  .word-study-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .word-study-actions button {
    padding: 14px 32px;
    font-size: 1.1rem;
    font-weight: bold;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    transition: transform 0.2s;
    color: #2c3e50;
  }

  .word-study-actions button:hover {
    transform: scale(1.06);
  }

  /* ë‹¨ê³„ ì„ íƒ ë²„íŠ¼ ê·¸ë£¹ */
  .level-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
  }

  .level-action-btn {
    padding: 8px 14px;
    border: none;
    border-radius: 14px;
    font-size: 0.85rem;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.2s;
    color: #2c3e50;
  }

  .level-action-btn:hover {
    transform: scale(1.08);
  }

  /* ë°˜ì‘í˜• */
  @media (max-width: 600px) {
    .learn-grid {
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 10px;
      padding: 14px;
    }
    .letter-card .upper { font-size: 1.8rem; }
    .letter-card .lower { font-size: 1.3rem; }
    .overlay-card .upper { font-size: 5rem; }
    .overlay-card .lower { font-size: 3rem; }
    .quiz-prompt { font-size: 5rem; }
    .quiz-option { font-size: 2rem; padding: 16px; }
    nav button { padding: 10px 24px; font-size: 1rem; }
    .word-study-grid { grid-template-columns: repeat(4, 1fr); gap: 8px; }
    .word-study-card .emoji { font-size: 1.6rem; }
    .word-study-card .word { font-size: 0.8rem; }
    .level-actions { gap: 6px; }
    .level-action-btn { padding: 6px 10px; font-size: 0.8rem; }
  }
</style>
</head>
<body>

<nav>
  <button class="active" onclick="showLearn()">ğŸ“– í•™ìŠµ</button>
  <button onclick="showQuiz()">âœï¸ í€´ì¦ˆ</button>
  <button onclick="showListenQuiz()">ğŸ”Š ë“£ê¸°</button>
  <button onclick="showWordQuiz()">ğŸ“ ë‹¨ì–´</button>
</nav>

<div id="learn">
  <div class="learn-grid" id="letterGrid"></div>
  <div class="records-section" id="recordsSection"></div>
</div>

<div id="quiz"></div>
<div id="listenQuiz"></div>
<div id="wordQuiz"></div>

<div class="overlay" id="overlay" onclick="closeOverlay()">
  <div class="overlay-card" id="overlayCard">
    <div class="upper" id="overlayUpper"></div>
    <div class="lower" id="overlayLower"></div>
  </div>
</div>

<script>
// --- localStorage DB ---
const DB_KEY = 'alphabet_records';

function dbLoad() {
  try { return JSON.parse(localStorage.getItem(DB_KEY)) || {}; }
  catch { return {}; }
}

function dbSave(data) {
  localStorage.setItem(DB_KEY, JSON.stringify(data));
}

function getToday() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

// type: 'quiz' | 'listen' | 'word'
function saveScore(type, score, total) {
  const db = dbLoad();
  const today = getToday();

  if (!db[type]) db[type] = {};

  // ë‚ ì§œë³„ ê¸°ë¡ â€” ìµœê³  ì ìˆ˜ë§Œ ìœ ì§€
  const prev = db[type][today];
  if (!prev || score > prev.score) {
    db[type][today] = { score, total };
  }

  // ì „ì²´ ìµœê³  ê¸°ë¡
  const best = db[type]._best;
  if (!best || score > best.score) {
    db[type]._best = { score, total };
  }

  dbSave(db);
  updateNavBadges();
}

function getBest(type) {
  const db = dbLoad();
  return db[type]?._best || null;
}

function getTodayScore(type) {
  const db = dbLoad();
  return db[type]?.[getToday()] || null;
}

const WORD_LEVEL_KEYS = ['word_1','word_2','word_3','word_4','word_5'];
const ALL_SCORE_KEYS = ['quiz','listen',...WORD_LEVEL_KEYS];

// ìµœê·¼ Nì¼ ê¸°ë¡ (ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ)
function getHistory(limit = 10) {
  const db = dbLoad();
  const dateSet = new Set();
  ALL_SCORE_KEYS.forEach(type => {
    if (db[type]) {
      Object.keys(db[type]).filter(k => k !== '_best').forEach(d => dateSet.add(d));
    }
  });
  const dates = [...dateSet].sort().reverse().slice(0, limit);
  return dates.map(date => ({
    date,
    quiz: db.quiz?.[date] || null,
    listen: db.listen?.[date] || null,
    word: WORD_LEVEL_KEYS.map(k => db[k]?.[date] || null),
  }));
}

// ë‹¨ì–´ í€´ì¦ˆ: ì˜¤ëŠ˜ í´ë¦¬ì–´í•œ ë‹¨ê³„ ìˆ˜
function getWordClearedCount() {
  let count = 0;
  WORD_LEVEL_KEYS.forEach(k => {
    if (getTodayScore(k)) count++;
  });
  return count;
}

function updateNavBadges() {
  const navBtns = document.querySelectorAll('nav button');
  const types = [null, 'quiz', 'listen', 'word_badge']; // í•™ìŠµì€ ë±ƒì§€ ì—†ìŒ

  types.forEach((type, i) => {
    const btn = navBtns[i];
    if (!btn || !type) return;
    // ê¸°ì¡´ ë±ƒì§€ ì œê±°
    const old = btn.querySelector('.nav-badge');
    if (old) old.remove();

    if (type === 'word_badge') {
      const cleared = getWordClearedCount();
      if (cleared > 0) {
        const badge = document.createElement('span');
        badge.className = 'nav-badge cleared';
        badge.textContent = `${cleared}/5`;
        btn.appendChild(badge);
      }
    } else {
      const today = getTodayScore(type);
      if (today) {
        const badge = document.createElement('span');
        badge.className = 'nav-badge cleared';
        badge.textContent = `${today.score}/${today.total}`;
        btn.appendChild(badge);
      }
    }
  });
}

function renderRecords() {
  const el = document.getElementById('recordsSection');
  const bestQuiz = getBest('quiz');
  const bestListen = getBest('listen');
  // ë‹¨ì–´: í´ë¦¬ì–´í•œ ë‹¨ê³„ ìˆ˜ (best ê¸°ì¤€)
  const wordCleared = WORD_LEVEL_KEYS.filter(k => getBest(k)).length;
  const history = getHistory(7);

  const fmtBest = (b) => b ? `${b.score}<small>/${b.total}</small>` : '-';

  const fmtDate = (d) => {
    const [,m,day] = d.split('-');
    return `${+m}ì›” ${+day}ì¼`;
  };

  const fmtTag = (rec, cls) => {
    if (!rec) return `<span class="no-record">-</span>`;
    return `<span class="${cls}">${rec.score}/${rec.total}</span>`;
  };

  // ë‹¨ì–´ íˆìŠ¤í† ë¦¬: í•´ë‹¹ ë‚ ì§œì— í´ë¦¬ì–´í•œ ë‹¨ê³„ ìˆ˜
  const fmtWordTag = (wordArr) => {
    const cleared = wordArr.filter(w => w !== null).length;
    if (cleared === 0) return `<span class="no-record">-</span>`;
    return `<span class="word-tag">${cleared}/5ë‹¨ê³„</span>`;
  };

  el.innerHTML = `
    <h3>ë‚˜ì˜ ê¸°ë¡</h3>
    <div class="records-grid">
      <div class="record-card">
        <div class="record-label">í€´ì¦ˆ ìµœê³ </div>
        <div class="record-best">${fmtBest(bestQuiz)}</div>
      </div>
      <div class="record-card">
        <div class="record-label">ë“£ê¸° ìµœê³ </div>
        <div class="record-best">${fmtBest(bestListen)}</div>
      </div>
      <div class="record-card">
        <div class="record-label">ë‹¨ì–´ í´ë¦¬ì–´</div>
        <div class="record-best">${wordCleared}<small>/5</small></div>
      </div>
    </div>
    <div class="history-list">
      <h4>ìµœê·¼ ê¸°ë¡</h4>
      ${history.length === 0 ? '<div class="history-empty">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”!</div>' :
        history.map(h => `
          <div class="history-row">
            <span class="history-date">${fmtDate(h.date)}</span>
            <div class="history-scores">
              ${fmtTag(h.quiz, 'quiz-tag')}
              ${fmtTag(h.listen, 'listen-tag')}
              ${fmtWordTag(h.word)}
            </div>
          </div>
        `).join('')
      }
    </div>
  `;
}

const COLORS = [
  '#FFD3B6','#FFAAA5','#FF8B94','#A8E6CF','#DCEDC1',
  '#FFD3B6','#B5EAD7','#C7CEEA','#E2F0CB','#FFDAC1',
  '#F3B0C3','#C6DBF0','#FCE4EC','#E8DFF5','#FEE1E8',
  '#D4F0F0','#CCE2CB','#B6CFB6','#97C1A9','#FCB9AA',
  '#FFDBCC','#ECEAE4','#A2E1DB','#55CBCD','#ABDEE6',
  '#CBAACB'
];

const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');

// --- í•™ìŠµ ëª¨ë“œ ---
function buildGrid() {
  const grid = document.getElementById('letterGrid');
  grid.innerHTML = '';
  letters.forEach((ch, i) => {
    const card = document.createElement('div');
    card.className = 'letter-card';
    card.style.background = COLORS[i];
    card.innerHTML = `<span class="upper">${ch}</span><span class="lower">${ch.toLowerCase()}</span>`;
    card.onclick = () => openOverlay(ch, COLORS[i]);
    grid.appendChild(card);
  });
}

function openOverlay(ch, color) {
  const overlay = document.getElementById('overlay');
  document.getElementById('overlayCard').style.background = color;
  document.getElementById('overlayUpper').textContent = ch;
  document.getElementById('overlayLower').textContent = ch.toLowerCase();
  overlay.classList.add('show');
}

function closeOverlay() {
  document.getElementById('overlay').classList.remove('show');
}

// --- í€´ì¦ˆ ëª¨ë“œ ---
let quizQuestions = [];
let currentQ = 0;
let correctCount = 0;
let answered = false;

function generateQuiz() {
  quizQuestions = [];
  const shuffled = [...letters].sort(() => Math.random() - 0.5);
  shuffled.forEach(ch => {
    const isUpperPrompt = Math.random() > 0.5;
    const prompt = isUpperPrompt ? ch : ch.toLowerCase();
    const answerChar = isUpperPrompt ? ch.toLowerCase() : ch;

    const wrong = new Set();
    while (wrong.size < 3) {
      const r = letters[Math.floor(Math.random() * 26)];
      const w = isUpperPrompt ? r.toLowerCase() : r;
      if (w !== answerChar) wrong.add(w);
    }

    const options = [answerChar, ...wrong].sort(() => Math.random() - 0.5);
    quizQuestions.push({ prompt, answer: answerChar, options });
  });
}

function renderQuiz() {
  const el = document.getElementById('quiz');

  if (currentQ >= quizQuestions.length) {
    showResult(el);
    return;
  }

  const q = quizQuestions[currentQ];
  const pct = (currentQ / quizQuestions.length) * 100;

  el.innerHTML = `
    <div class="progress-bar"><div class="fill" style="width:${pct}%"></div></div>
    <div class="progress-text">${currentQ + 1} / ${quizQuestions.length}</div>
    <div class="quiz-prompt">${q.prompt}</div>
    <div class="quiz-options">
      ${q.options.map((o, i) => `<button class="quiz-option" data-idx="${i}" onclick="pickAnswer(this, '${o}', '${q.answer}')">${o}</button>`).join('')}
    </div>
  `;
  answered = false;
}

function pickAnswer(btn, picked, answer) {
  if (answered) return;
  answered = true;

  const buttons = document.querySelectorAll('.quiz-option');

  if (picked === answer) {
    correctCount++;
    btn.classList.add('correct');
    spawnConfetti();
  } else {
    btn.classList.add('wrong');
    buttons.forEach(b => {
      if (b.textContent === answer) b.classList.add('reveal');
    });
  }

  setTimeout(() => {
    currentQ++;
    renderQuiz();
  }, 1000);
}

function showResult(el) {
  saveScore('quiz', correctCount, quizQuestions.length);
  const pct = Math.round((correctCount / quizQuestions.length) * 100);
  let msg = 'ë‹¤ì‹œ ë„ì „í•´ ë³¼ê¹Œìš”?';
  if (pct >= 90) msg = 'ì •ë§ ëŒ€ë‹¨í•´ìš”! ğŸ‰';
  else if (pct >= 70) msg = 'ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•´ìš”!';
  else if (pct >= 50) msg = 'ì¢‹ì€ ì‹œì‘ì´ì—ìš”! ê³„ì† í•´ë´ìš”!';

  const best = getBest('quiz');
  const bestText = best ? `ìµœê³  ê¸°ë¡: ${best.score}/${best.total}` : '';

  el.innerHTML = `
    <div class="result">
      <h2>í€´ì¦ˆ ì™„ë£Œ!</h2>
      <div class="score">${correctCount} / ${quizQuestions.length}</div>
      <div class="message">${msg}</div>
      ${bestText ? `<div style="color:#aa96da;font-weight:bold;margin-bottom:16px;">${bestText}</div>` : ''}
      <button onclick="restartQuiz()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
  `;
}

function restartQuiz() {
  currentQ = 0;
  correctCount = 0;
  generateQuiz();
  renderQuiz();
}

// --- confetti ---
function spawnConfetti() {
  const colors = ['#ff6b6b','#ffd93d','#6bcb77','#4d96ff','#ff6bcb','#aa96da'];
  for (let i = 0; i < 30; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + 'vw';
    piece.style.top = '-10px';
    piece.style.background = colors[Math.floor(Math.random() * colors.length)];
    piece.style.animationDuration = (0.8 + Math.random() * 0.8) + 's';
    piece.style.animationDelay = (Math.random() * 0.3) + 's';
    document.body.appendChild(piece);
    setTimeout(() => piece.remove(), 2000);
  }
}

// --- ë“£ê¸° í€´ì¦ˆ ëª¨ë“œ ---
let listenQuestions = [];
let listenCurrentQ = 0;
let listenCorrectCount = 0;
let listenAnswered = false;

// macOS ì—¬ì„± ì˜ì–´ ìŒì„± ìš°ì„ ìˆœìœ„
const PREFERRED_VOICES = ['Samantha', 'Nicky', 'Kathy', 'Shelley (ì˜ì–´(ë¯¸êµ­))', 'Flo (ì˜ì–´(ë¯¸êµ­))'];
let cachedVoice = null;

function getPreferredVoice() {
  if (cachedVoice) return cachedVoice;
  const voices = speechSynthesis.getVoices();
  cachedVoice =
    PREFERRED_VOICES.reduce((found, name) => found || voices.find(v => v.name === name), null) ||
    voices.find(v => v.lang === 'en-US');
  return cachedVoice;
}

// ìŒì„± ëª©ë¡ ë¡œë“œ ì‹œ ìºì‹œ ê°±ì‹ 
speechSynthesis.onvoiceschanged = () => { cachedVoice = null; getPreferredVoice(); };

function speakLetter(ch, callback) {
  speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(ch.toLowerCase());
  utter.lang = 'en-US';
  utter.rate = 0.6;
  utter.pitch = 1.0;
  utter.volume = 1;
  utter.voice = getPreferredVoice();

  const speakerBtn = document.getElementById('speakerBtn');
  if (speakerBtn) speakerBtn.classList.add('playing');
  utter.onend = () => {
    if (speakerBtn) speakerBtn.classList.remove('playing');
    if (callback) callback();
  };
  speechSynthesis.speak(utter);
}

function randomCase(ch) {
  return Math.random() > 0.5 ? ch.toUpperCase() : ch.toLowerCase();
}

function generateListenQuiz() {
  listenQuestions = [];
  const shuffled = [...letters].sort(() => Math.random() - 0.5);
  shuffled.forEach(ch => {
    const wrongLetters = new Set();
    while (wrongLetters.size < 3) {
      const r = letters[Math.floor(Math.random() * 26)];
      if (r !== ch) wrongLetters.add(r);
    }
    // ê° ë³´ê¸°ë¥¼ ëœë¤í•˜ê²Œ ëŒ€ë¬¸ì ë˜ëŠ” ì†Œë¬¸ìë¡œ í‘œì‹œ
    const answerDisplay = randomCase(ch);
    const wrongDisplays = [...wrongLetters].map(w => randomCase(w));
    const options = [answerDisplay, ...wrongDisplays].sort(() => Math.random() - 0.5);
    listenQuestions.push({ letter: ch, answerDisplay, options });
  });
}

function renderListenQuiz() {
  const el = document.getElementById('listenQuiz');

  if (listenCurrentQ >= listenQuestions.length) {
    showListenResult(el);
    return;
  }

  const q = listenQuestions[listenCurrentQ];
  const pct = (listenCurrentQ / listenQuestions.length) * 100;

  el.innerHTML = `
    <div class="progress-bar"><div class="fill" style="width:${pct}%"></div></div>
    <div class="progress-text">${listenCurrentQ + 1} / ${listenQuestions.length}</div>
    <div class="listen-hint">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•ŒíŒŒë²³ì„ ë“¤ì–´ë³´ì„¸ìš”!</div>
    <button class="speaker-btn" id="speakerBtn" onclick="speakLetter('${q.letter}')">ğŸ”Š</button>
    <div class="quiz-options">
      ${q.options.map(o => `<button class="quiz-option" onclick="pickListenAnswer(this, '${o.toUpperCase()}', '${q.letter}', '${q.answerDisplay}')">${o}</button>`).join('')}
    </div>
  `;
  listenAnswered = false;

  // ìë™ìœ¼ë¡œ í•œ ë²ˆ ì½ì–´ì£¼ê¸°
  setTimeout(() => speakLetter(q.letter), 300);
}

function pickListenAnswer(btn, picked, answer, answerDisplay) {
  if (listenAnswered) return;
  listenAnswered = true;

  const buttons = document.querySelectorAll('#listenQuiz .quiz-option');

  if (picked === answer) {
    listenCorrectCount++;
    btn.classList.add('correct');
    spawnConfetti();
  } else {
    btn.classList.add('wrong');
    buttons.forEach(b => {
      if (b.textContent.trim() === answerDisplay) b.classList.add('reveal');
    });
  }

  setTimeout(() => {
    listenCurrentQ++;
    renderListenQuiz();
  }, 1000);
}

function showListenResult(el) {
  saveScore('listen', listenCorrectCount, listenQuestions.length);
  const pct = Math.round((listenCorrectCount / listenQuestions.length) * 100);
  let msg = 'ë‹¤ì‹œ ë„ì „í•´ ë³¼ê¹Œìš”?';
  if (pct >= 90) msg = 'ê·€ê°€ ì•„ì£¼ ì¢‹ì•„ìš”! ğŸ‰';
  else if (pct >= 70) msg = 'ì˜ ë“¤ì—ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë”!';
  else if (pct >= 50) msg = 'ì¢‹ì€ ì‹œì‘ì´ì—ìš”! ë‹¤ì‹œ ë“¤ì–´ë´ìš”!';

  const best = getBest('listen');
  const bestText = best ? `ìµœê³  ê¸°ë¡: ${best.score}/${best.total}` : '';

  el.innerHTML = `
    <div class="result">
      <h2>ë“£ê¸° í€´ì¦ˆ ì™„ë£Œ!</h2>
      <div class="score">${listenCorrectCount} / ${listenQuestions.length}</div>
      <div class="message">${msg}</div>
      ${bestText ? `<div style="color:#aa96da;font-weight:bold;margin-bottom:16px;">${bestText}</div>` : ''}
      <button onclick="restartListenQuiz()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
  `;
}

function restartListenQuiz() {
  listenCurrentQ = 0;
  listenCorrectCount = 0;
  generateListenQuiz();
  renderListenQuiz();
}

// --- ë‹¨ì–´ ë“£ê¸° í€´ì¦ˆ ---
const WORD_EMOJI = {
  // 1ë‹¨ê³„: ë™ë¬¼
  CAT:'ğŸ±',DOG:'ğŸ¶',PIG:'ğŸ·',HEN:'ğŸ”',COW:'ğŸ®',FOX:'ğŸ¦Š',BEE:'ğŸ',ANT:'ğŸœ',BAT:'ğŸ¦‡',OWL:'ğŸ¦‰',
  RAM:'ğŸ',YAK:'ğŸƒ',APE:'ğŸ¦',EMU:'ğŸ¦',COD:'ğŸŸ',PUP:'ğŸ•',CUB:'ğŸ§¸',KIT:'ğŸˆ',DOE:'ğŸ¦Œ',ELK:'ğŸ«',
  // 2ë‹¨ê³„: ìŒì‹
  EGG:'ğŸ¥š',JAM:'ğŸ¯',PIE:'ğŸ¥§',TEA:'ğŸµ',NUT:'ğŸ¥œ',GUM:'ğŸ«§',HAM:'ğŸ–',BUN:'ğŸ',FIG:'ğŸ«',PEA:'ğŸ«›',
  ICE:'ğŸ§Š',SOY:'ğŸ«˜',DIP:'ğŸ«•',CUP:'ğŸ¥¤',MUG:'â˜•',PAN:'ğŸ³',POT:'ğŸ²',JAR:'ğŸº',CAN:'ğŸ¥«',BOX:'ğŸ“¦',
  // 3ë‹¨ê³„: ì‚¬ë¬¼
  BED:'ğŸ›ï¸',BUS:'ğŸšŒ',MAP:'ğŸ—ºï¸',PEN:'ğŸ–Šï¸',FAN:'ğŸª­',HAT:'ğŸ©',BAG:'ğŸ‘œ',KEY:'ğŸ”‘',DOOR:'ğŸšª',BOOK:'ğŸ“–',
  BELL:'ğŸ””',DESK:'ğŸª‘',LAMP:'ğŸ’¡',RING:'ğŸ’',SOCK:'ğŸ§¦',SHOE:'ğŸ‘Ÿ',BALL:'âš½',KITE:'ğŸª',BIKE:'ğŸš²',DRUM:'ğŸ¥',
  // 4ë‹¨ê³„: ìì—°
  BLUE:'ğŸ”µ',PINK:'ğŸ©·',GOLD:'ğŸŒŸ',TREE:'ğŸŒ³',RAIN:'ğŸŒ§ï¸',SNOW:'â„ï¸',STAR:'â­',MOON:'ğŸŒ™',LAKE:'ğŸï¸',SAND:'ğŸ–ï¸',
  LEAF:'ğŸƒ',SEED:'ğŸŒ±',WIND:'ğŸ’¨',WAVE:'ğŸŒŠ',FIRE:'ğŸ”¥',ROSE:'ğŸŒ¹',LILY:'ğŸª·',VINE:'ğŸŒ¿',FERN:'â˜˜ï¸',MOSS:'ğŸª¨',
  // 5ë‹¨ê³„: ê¸´ ë‹¨ì–´
  SMILE:'ğŸ˜Š',DANCE:'ğŸ’ƒ',DREAM:'ğŸ’­',HAPPY:'ğŸ˜„',SLEEP:'ğŸ˜´',DRINK:'ğŸ¥›',BREAD:'ğŸ',CHAIR:'ğŸª‘',CLOCK:'â°',CLOUD:'â˜ï¸',
  GRAPE:'ğŸ‡',LEMON:'ğŸ‹',MELON:'ğŸˆ',NURSE:'ğŸ‘©â€âš•ï¸',PAINT:'ğŸ¨',QUEEN:'ğŸ‘‘',RIVER:'ğŸï¸',SNAKE:'ğŸ',TIGER:'ğŸ¯',ZEBRA:'ğŸ¦“',
};

const WORD_LEVELS = [
  { level: 1, name: 'ë™ë¬¼ ì¹œêµ¬', color: '#a8d8ea', words: ['CAT','DOG','PIG','HEN','COW','FOX','BEE','ANT','BAT','OWL','RAM','YAK','APE','EMU','COD','PUP','CUB','KIT','DOE','ELK'] },
  { level: 2, name: 'ë§›ìˆëŠ” ìŒì‹', color: '#ffb6b9', words: ['EGG','JAM','PIE','TEA','NUT','GUM','HAM','BUN','FIG','PEA','ICE','SOY','DIP','CUP','MUG','PAN','POT','JAR','CAN','BOX'] },
  { level: 3, name: 'ìš°ë¦¬ ì£¼ë³€', color: '#aa96da', words: ['BED','BUS','MAP','PEN','FAN','HAT','BAG','KEY','DOOR','BOOK','BELL','DESK','LAMP','RING','SOCK','SHOE','BALL','KITE','BIKE','DRUM'] },
  { level: 4, name: 'ìƒ‰ê¹”ê³¼ ìì—°', color: '#a8e6cf', words: ['BLUE','PINK','GOLD','TREE','RAIN','SNOW','STAR','MOON','LAKE','SAND','LEAF','SEED','WIND','WAVE','FIRE','ROSE','LILY','VINE','FERN','MOSS'] },
  { level: 5, name: 'ë„ì „! ê¸´ ë‹¨ì–´', color: '#ffd3b6', words: ['SMILE','DANCE','DREAM','HAPPY','SLEEP','DRINK','BREAD','CHAIR','CLOCK','CLOUD','GRAPE','LEMON','MELON','NURSE','PAINT','QUEEN','RIVER','SNAKE','TIGER','ZEBRA'] },
];

let currentWordLevel = null; // null = ë‹¨ê³„ ì„ íƒ í™”ë©´
let wordQuestions = [];
let wordCurrentQ = 0;
let wordCorrectCount = 0;
let wordAnswered = false;

function speakWord(word) {
  speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(word.toLowerCase());
  utter.lang = 'en-US';
  utter.rate = 0.6;
  utter.pitch = 1.0;
  utter.volume = 1;
  utter.voice = getPreferredVoice();

  const btn = document.getElementById('wordSpeakerBtn');
  if (btn) btn.classList.add('playing');
  utter.onend = () => {
    if (btn) btn.classList.remove('playing');
  };
  speechSynthesis.speak(utter);
}

function generateWordQuiz(levelIdx) {
  currentWordLevel = levelIdx;
  wordQuestions = [];
  const levelData = WORD_LEVELS[levelIdx];
  const pool = levelData.words;
  const shuffled = [...pool].sort(() => Math.random() - 0.5);
  shuffled.forEach(word => {
    const wrongWords = new Set();
    while (wrongWords.size < 3) {
      const r = pool[Math.floor(Math.random() * pool.length)];
      if (r !== word) wrongWords.add(r);
    }
    const options = [word, ...wrongWords].sort(() => Math.random() - 0.5);
    wordQuestions.push({ word, options });
  });
}

function renderWordLevelSelect() {
  const el = document.getElementById('wordQuiz');
  el.innerHTML = `
    <div class="level-select">
      <h2>ë‹¨ì–´ í€´ì¦ˆ ë‹¨ê³„ ì„ íƒ</h2>
      <div class="level-cards">
        ${WORD_LEVELS.map((lv, i) => {
          const best = getBest('word_' + lv.level);
          const preview = lv.words.slice(0, 3).map(w => `${WORD_EMOJI[w] || ''} ${w.toLowerCase()}`).join(', ');
          return `
            <div class="level-card" style="cursor:default;">
              <div class="level-num" style="background:${lv.color}">${lv.level}</div>
              <div class="level-info">
                <div class="level-name">${lv.name}</div>
                <div class="level-preview">${preview} ...</div>
              </div>
              ${best ? `<div class="level-best">${best.score}/${best.total}</div>` : ''}
              <div class="level-actions">
                <button class="level-action-btn" style="background:${lv.color}44;" onclick="renderWordStudy(${i})">ğŸ“– í•™ìŠµ</button>
                <button class="level-action-btn" style="background:${lv.color};" onclick="startWordLevel(${i})">âœï¸ í€´ì¦ˆ</button>
              </div>
            </div>
          `;
        }).join('')}
      </div>
    </div>
  `;
}

function renderWordStudy(levelIdx) {
  const el = document.getElementById('wordQuiz');
  const lv = WORD_LEVELS[levelIdx];
  el.innerHTML = `
    <div class="word-study">
      <h2>${lv.name}</h2>
      <div class="word-study-grid">
        ${lv.words.map(w => `
          <div class="word-study-card" onclick="speakWord('${w}')">
            <div class="emoji">${WORD_EMOJI[w] || ''}</div>
            <div class="word">${w.toLowerCase()}</div>
          </div>
        `).join('')}
      </div>
      <div class="word-study-actions">
        <button style="background:${lv.color};" onclick="startWordLevel(${levelIdx})">âœï¸ í€´ì¦ˆ ì‹œì‘</button>
        <button style="background:#eee;" onclick="renderWordLevelSelect()">ë‹¨ê³„ ì„ íƒ</button>
      </div>
    </div>
  `;
}

function startWordLevel(levelIdx) {
  wordCurrentQ = 0;
  wordCorrectCount = 0;
  generateWordQuiz(levelIdx);
  renderWordQuiz();
}

function renderWordQuiz() {
  const el = document.getElementById('wordQuiz');

  if (wordCurrentQ >= wordQuestions.length) {
    showWordResult(el);
    return;
  }

  const q = wordQuestions[wordCurrentQ];
  const pct = (wordCurrentQ / wordQuestions.length) * 100;

  el.innerHTML = `
    <div class="progress-bar"><div class="fill" style="width:${pct}%"></div></div>
    <div class="progress-text">${wordCurrentQ + 1} / ${wordQuestions.length}</div>
    <div class="listen-hint">ë‹¨ì–´ë¥¼ ë“£ê³  ë§ëŠ” ê²ƒì„ ê³¨ë¼ë³´ì„¸ìš”!</div>
    <button class="speaker-btn" id="wordSpeakerBtn" onclick="speakWord('${q.word}')" style="background:linear-gradient(135deg,#a8e6cf,#b5ead7);">ğŸ”Š</button>
    <div class="quiz-options">
      ${q.options.map(o => `<button class="quiz-option" style="font-size:1.6rem;" onclick="pickWordAnswer(this, '${o}', '${q.word}')"><span style="font-size:2rem;">${WORD_EMOJI[o] || ''}</span><br>${o.toLowerCase()}</button>`).join('')}
    </div>
  `;
  wordAnswered = false;

  setTimeout(() => speakWord(q.word), 300);
}

function pickWordAnswer(btn, picked, answer) {
  if (wordAnswered) return;
  wordAnswered = true;

  const buttons = document.querySelectorAll('#wordQuiz .quiz-option');

  if (picked === answer) {
    wordCorrectCount++;
    btn.classList.add('correct');
    spawnConfetti();
  } else {
    btn.classList.add('wrong');
    buttons.forEach(b => {
      if (b.textContent.trim() === answer.toLowerCase()) b.classList.add('reveal');
    });
  }

  setTimeout(() => {
    wordCurrentQ++;
    renderWordQuiz();
  }, 1200);
}

function showWordResult(el) {
  const levelNum = WORD_LEVELS[currentWordLevel].level;
  const levelName = WORD_LEVELS[currentWordLevel].name;
  saveScore('word_' + levelNum, wordCorrectCount, wordQuestions.length);
  const pct = Math.round((wordCorrectCount / wordQuestions.length) * 100);
  let msg = 'ë‹¤ì‹œ ë„ì „í•´ ë³¼ê¹Œìš”?';
  if (pct >= 90) msg = 'ë‹¨ì–´ ë°•ì‚¬! ğŸ‰';
  else if (pct >= 70) msg = 'ì˜í–ˆì–´ìš”! ê±°ì˜ ë‹¤ ë§í˜”ì–´ìš”!';
  else if (pct >= 50) msg = 'ì¢‹ì•„ìš”! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•´ìš”!';

  const best = getBest('word_' + levelNum);
  const bestText = best ? `ìµœê³  ê¸°ë¡: ${best.score}/${best.total}` : '';
  const hasNext = currentWordLevel < WORD_LEVELS.length - 1;

  el.innerHTML = `
    <div class="result">
      <h2>${levelName} ì™„ë£Œ!</h2>
      <div class="score">${wordCorrectCount} / ${wordQuestions.length}</div>
      <div class="message">${msg}</div>
      ${bestText ? `<div style="color:#aa96da;font-weight:bold;margin-bottom:16px;">${bestText}</div>` : ''}
      <div style="display:flex;flex-direction:column;gap:10px;align-items:center;">
        <button onclick="restartWordQuiz()">ë‹¤ì‹œ í•˜ê¸°</button>
        ${hasNext ? `<button onclick="startWordLevel(${currentWordLevel + 1})" style="background:#a8e6cf;">ë‹¤ìŒ ë‹¨ê³„</button>` : ''}
        <button onclick="renderWordLevelSelect()" style="background:#a8d8ea;">ë‹¨ê³„ ì„ íƒ</button>
      </div>
    </div>
  `;
}

function restartWordQuiz() {
  wordCurrentQ = 0;
  wordCorrectCount = 0;
  generateWordQuiz(currentWordLevel);
  renderWordQuiz();
}

// --- íƒ­ ì „í™˜ ---
function hideAll() {
  document.getElementById('learn').style.display = 'none';
  document.getElementById('quiz').style.display = 'none';
  document.getElementById('listenQuiz').style.display = 'none';
  document.getElementById('wordQuiz').style.display = 'none';
}

function showLearn() {
  hideAll();
  document.getElementById('learn').style.display = 'block';
  document.querySelectorAll('nav button').forEach((b, i) => b.classList.toggle('active', i === 0));
  renderRecords();
}

function showQuiz() {
  hideAll();
  document.getElementById('quiz').style.display = 'block';
  document.querySelectorAll('nav button').forEach((b, i) => b.classList.toggle('active', i === 1));
  if (quizQuestions.length === 0) {
    generateQuiz();
  }
  renderQuiz();
}

function showListenQuiz() {
  hideAll();
  document.getElementById('listenQuiz').style.display = 'block';
  document.querySelectorAll('nav button').forEach((b, i) => b.classList.toggle('active', i === 2));
  if (listenQuestions.length === 0) {
    generateListenQuiz();
  }
  renderListenQuiz();
}

function showWordQuiz() {
  hideAll();
  document.getElementById('wordQuiz').style.display = 'block';
  document.querySelectorAll('nav button').forEach((b, i) => b.classList.toggle('active', i === 3));
  currentWordLevel = null;
  wordQuestions = [];
  renderWordLevelSelect();
}

// Service Worker ë“±ë¡
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}

// ì´ˆê¸°í™”
buildGrid();
renderRecords();
updateNavBadges();
</script>
</body>
</html>
